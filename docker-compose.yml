version: '3'

services:

    server:
        image: postgrest/postgrest
        ports:
          - "3005:3000"
        links:
          - db:db
        environment:
          PGRST_DB_URI: postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@atlas-db:5432/postgres
          PGRST_DB_SCHEMA: public
          PGRST_DB_ANON_ROLE: postgres #In production this role should not be the same as the one used for the connection
          PGRST_SERVER_PROXY_URI: "http://127.0.0.1:3000"
        links:
          - atlas-db
    atlas-db:
        build:
            context: ./
        ports:
            - 5434:5432
        environment:
            POSTGRES_USER: ${POSTGRES_USER}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            POSTGRES_DB: ${POSTGRES_DB}